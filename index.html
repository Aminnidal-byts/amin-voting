<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ভোটিং সিস্টেম - নাম দিয়ে ভোট</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* তোমার আগের CSS অংশটা এখানে কপি করো (সুন্দর ডিজাইনের জন্য)। আমি সংক্ষিপ্ত রাখছি, কিন্তু তোমার পুরোটা ব্যবহার করো। */
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); color: #1e293b; }
    .container { max-width: 900px; margin: auto; background: rgba(255,255,255,0.7); padding: 40px; border-radius: 20px; }
    /* বাকি CSS যেমন candidates, button ইত্যাদি আগের মতো রাখো। */
  </style>
</head>
<body>

<div class="container">
  <h1>ভোটিং সিস্টেম</h1>

  <button class="admin-btn" onclick="showAdminLogin()">অ্যাডমিন প্যানেল</button>

  <div id="admin-login" style="display:none;">
    <h2>অ্যাডমিন লগইন</h2>
    <input type="password" id="adminPass" placeholder="পাসওয়ার্ড (ডিফল্ট: admin)">
    <button onclick="loginAdmin()">লগইন</button>
  </div>

  <div id="admin-section" style="display:none;">
    <h2>অ্যাডমিন প্যানেল</h2>
    <div id="admin-results"></div>
    <div id="voted-list"></div>
    <button class="back-btn" onclick="backToVoting()">← ভোটিং পেজে ফিরে যাও</button>
    <button class="reset-btn" onclick="resetAllVotes()">সব ভোট রিসেট করো</button>
    <button onclick="logoutAdmin()">লগআউট</button>
  </div>

  <div id="voter-section">
    <h2>তোমার নাম লিখো</h2>
    <input type="text" id="voterName" placeholder="যেমন: আমিন, রহিম...">
    <button onclick="startVoting()">ভোট দিতে যাও →</button>
  </div>

  <div id="vote-section" style="display:none;">
    <h2>কাকে ভোট দেবে?</h2>
    <div class="candidates">
      <!-- তোমার ক্যান্ডিডেট কার্ডগুলো এখানে, ইমেজ সহ -->
      <div class="candidate">
        <div class="symbol"><img src="https://c8.alamy.com/comp/HCDFPA/voting-symbols-with-fountain-pen-over-white-paper-HCDFPA.jpg" alt="কলম"></div>
        <div class="name">ইসফাক আমিন নিলফাজ</div>
        <div>মার্কা: কলম</div>
        <button class="kolom" onclick="vote('কলম')">কলম-এ ভোট দাও</button>
      </div>
      <!-- বাকি দুটো ক্যান্ডিডেটও যোগ করো -->
    </div>
  </div>

  <div id="message"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

<script>
  // তোমার Firebase কনফিগ পেস্ট করো
  const firebaseConfig = {
    apiKey: "তোমার-apiKey",
    authDomain: "তোমার-project.firebaseapp.com",
    databaseURL: "তোমার-databaseURL",
    projectId: "তোমার-projectId",
    storageBucket: "তোমার-storageBucket",
    messagingSenderId: "তোমার-senderId",
    appId: "তোমার-appId"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentVoter = null;
  const adminPassword = "admin";

  function showAdminLogin() {
    document.getElementById('admin-login').style.display = 'block';
    document.getElementById('voter-section').style.display = 'none';
    document.getElementById('vote-section').style.display = 'none';
    showMessage('', '');
  }

  function loginAdmin() {
    const pass = document.getElementById('adminPass').value;
    if (pass === adminPassword) {
      document.getElementById('admin-login').style.display = 'none';
      document.getElementById('admin-section').style.display = 'block';
      loadAdminResults(); // রিয়েল-টাইম লোড
      showMessage('অ্যাডমিন প্যানেলে স্বাগতম!', 'success');
    } else {
      showMessage('ভুল পাসওয়ার্ড!', 'error');
    }
  }

  function logoutAdmin() {
    document.getElementById('admin-section').style.display = 'none';
    document.getElementById('voter-section').style.display = 'block';
    showMessage('', '');
  }

  function backToVoting() {
    document.getElementById('admin-section').style.display = 'none';
    document.getElementById('voter-section').style.display = 'block';
    showMessage('', '');
  }

  function startVoting() {
    currentVoter = document.getElementById('voterName').value.trim();
    if (!currentVoter) {
      showMessage("দয়া করে তোমার নাম লিখো!", "error");
      return;
    }

    // চেক করো যে আগে ভোট দিয়েছে কিনা (Firebase থেকে)
    db.ref('voterVotes/' + currentVoter).once('value').then(snapshot => {
      if (snapshot.exists()) {
        showMessage(`"${currentVoter}" নাম দিয়ে ইতিমধ্যে ভোট দেওয়া হয়েছে!`, "error");
        return;
      }
      document.getElementById('voter-section').style.display = 'none';
      document.getElementById('vote-section').style.display = 'block';
      showMessage(`ভোটার: ${currentVoter} — এখন ভোট দাও`, "success");
    });
  }

  function vote(symbol) {
    if (!currentVoter) return;

    // ভোট কাউন্ট আপডেট
    db.ref('votes/' + symbol).transaction(count => (count || 0) + 1);

    // ভোটার লিস্টে যোগ
    db.ref('voted').push(currentVoter);

    // ভোটার-স্পেসিফিক ভোট
    db.ref('voterVotes/' + currentVoter).set(symbol);

    showMessage(`ধন্যবাদ ${currentVoter}! তুমি ${symbol} এ ভোট দিয়েছ।`, "success");
    document.getElementById('vote-section').style.display = 'none';
    document.getElementById('voter-section').style.display = 'block';
    document.getElementById('voterName').value = '';
  }

  function loadAdminResults() {
    // রিয়েল-টাইম লিসেনার সেট করো
    db.ref('votes').on('value', snapshot => {
      const votes = snapshot.val() || {};
      const total = Object.values(votes).reduce((a, b) => a + b, 0);

      let html = '';
      const candidates = [
        {name: 'কলম (নিলফাজ)', key: 'কলম', color: '#4caf50'},
        {name: 'বই (নিহাল)', key: 'বই', color: '#ff9800'},
        {name: 'শাপলা (আয়েশা)', key: 'শাপলা', color: '#e91e63'}
      ];

      candidates.forEach(c => {
        const count = votes[c.key] || 0;
        const percent = total > 0 ? Math.round((count / total) * 100) : 0;
        html += `
          <div style="margin:15px 0;">
            <strong>${c.name}: ${count} ভোট (${percent}%)</strong>
            <div class="result-bar">
              <div class="bar-fill" style="width:${percent}%; background:${c.color};">
                ${percent > 5 ? percent + '%' : ''}
              </div>
            </div>
          </div>
        `;
      });

      html += `<p style="text-align:center; margin-top:25px;">মোট ভোট: ${total} / ১৭</p>`;
      document.getElementById('admin-results').innerHTML = html;
    });

    db.ref('voted').on('value', snapshot => {
      let votedList = [];
      snapshot.forEach(child => votedList.push(child.val()));
      document.getElementById('voted-list').innerHTML = votedList.map(v => `<li>${v}</li>`).join('');
    });
  }

  function resetAllVotes() {
    if (confirm('সত্যি সব ভোট রিসেট করবে?')) {
      db.ref('votes').remove();
      db.ref('voted').remove();
      db.ref('voterVotes').remove();
      showMessage('সব ভোট রিসেট করা হয়েছে!', 'success');
    }
  }

  function showMessage(text, type) {
    const msg = document.getElementById('message');
    msg.textContent = text;
    msg.className = type;
  }
</script>
</body>
</html>
